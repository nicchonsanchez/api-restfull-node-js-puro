<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Node.js Pura - Lista de Usuários</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background-color: #f4f4f9; }
        h1 { color: #333; }
        #users-list { 
            list-style: none; 
            padding: 0; 
            max-width: 600px;
        }
        .user-item {
            background: white;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .user-item strong {
            display: block;
            font-size: 1.1em;
            color: #007bff;
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <h1>Usuários da API Node.js Pura (CRUD)</h1>
    <p>Dados consumidos diretamente da API local: `GET http://localhost:3333/users`</p>
    
    <ul id="users-list">
        </ul>

    <script>
        // Local onde sua API está rodando
        const API_URL = 'http://localhost:3333/users';
        const usersList = document.getElementById('users-list');

        async function fetchUsers() {
            console.log(`[Frontend] Tentando buscar dados de: ${API_URL}`);
            
            try {
                // Faz a requisição GET para a API
                const response = await fetch(API_URL);

                // Se o navegador BLOQUEAR por CORS, o erro cairá no 'catch' antes mesmo daqui.
                
                // Verifica se a resposta foi bem-sucedida (status 200)
                if (!response.ok) {
                    // Se a API respondeu, mas com erro (404, 500, etc.)
                    throw new Error(`Erro na API: Status ${response.status} ${response.statusText}`);
                }

                // Converte a resposta para JSON
                const users = await response.json();
                
                console.log('[Frontend] Dados recebidos com sucesso:', users);

                // Limpa a lista antes de preencher
                usersList.innerHTML = ''; 

                if (users.length === 0) {
                    usersList.innerHTML = '<p>Nenhum usuário encontrado na base de dados.</p>';
                    return;
                }
                
                // Itera sobre os usuários e cria os elementos HTML
                users.forEach(user => {
                    const listItem = document.createElement('li');
                    listItem.className = 'user-item';
                    
                    // Assume que seus usuários têm 'id', 'name' e 'email'
                    listItem.innerHTML = `
                        <strong>${user.name}</strong>
                        ID: ${user.id}<br>
                        Email: ${user.email}
                    `;
                    usersList.appendChild(listItem);
                });

            } catch (error) {
                // Este bloco é executado se:
                // 1. O servidor Node.js estiver desligado.
                // 2. O navegador BLOQUEAR por CORS.
                
                console.error('[Frontend] Falha na Conexão/Requisição:', error);
                
                // Exibe uma mensagem de erro clara para o usuário
                usersList.innerHTML = `
                    <li class="user-item" style="background: #f8d7da; color: #721c24;">
                        <p><strong>ERRO DE CONEXÃO:</strong> Não foi possível buscar os usuários.</p>
                        <p>Por favor, verifique no seu Terminal se:</p>
                        <ol>
                            <li>O servidor Node.js está rodando (npm run dev).</li>
                            <li>Você adicionou os cabeçalhos <span style="font-family: monospace;">Access-Control-Allow-Origin: *</span> no seu <span style="font-family: monospace;">server.js</span> para resolver o CORS.</li>
                        </ol>
                    </li>
                `;
            }
        }

        // Chama a função ao carregar a página
        fetchUsers();
    </script>
</body>
</html>